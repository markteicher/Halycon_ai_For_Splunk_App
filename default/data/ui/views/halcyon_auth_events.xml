<form version="1.1" theme="light">
  <label>ğŸ” Authentication Events</label>
  <description>Authentication and authorization events generated by Halcyon.ai</description>

  <!-- ================= Filters ================= -->
  <fieldset submitButton="false">
    <input type="text" token="tok_user">
      <label>ğŸ‘¤ User / Email</label>
    </input>

    <input type="dropdown" token="tok_auth_result">
      <label>ğŸ“Œ Result</label>
      <choice value="*">All</choice>
      <choice value="success">Success</choice>
      <choice value="failure">Failure</choice>
      <default>*</default>
    </input>
  </fieldset>

  <!-- ================= KPI ROW ================= -->
  <row>
    <panel>
      <single>
        <title>ğŸ” Total Auth Events</title>
        <search>
          <query>
            index=security_halycon sourcetype="halcyon:auth_event"
            | stats count
          </query>
        </search>
        <option name="underLabel">Events</option>
      </single>
    </panel>

    <panel>
      <single>
        <title>âœ… Successful Logins</title>
        <search>
          <query>
            index=security_halycon sourcetype="halcyon:auth_event" result=success
            | stats count
          </query>
        </search>
        <option name="underLabel">Success</option>
      </single>
    </panel>

    <panel>
      <single>
        <title>âŒ Failed Logins</title>
        <search>
          <query>
            index=security_halycon sourcetype="halcyon:auth_event" result=failure
            | stats count
          </query>
        </search>
        <option name="underLabel">Failures</option>
      </single>
    </panel>
  </row>

  <!-- ================= AUTH EVENT TABLE ================= -->
  <row>
    <panel>
      <title>ğŸ“‹ Authentication Events</title>
      <table>
        <search>
          <query>
            index=security_halycon sourcetype="halcyon:auth_event"
            | eval blob=lower(coalesce(user,"")." ".coalesce(email,"")." ".coalesce(ipAddress,""))
            | where ("$tok_auth_result$"="*" OR result="$tok_auth_result$")
            | where ("$tok_user$"="" OR like(blob,"%".lower("$tok_user$")."%"))
            | eval eventTime=strftime(_time,"%Y-%m-%d %H:%M:%S")
            | table eventTime user email result ipAddress userAgent source
            | sort -eventTime
          </query>
        </search>
        <option name="count">50</option>
        <option name="wrap">true</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- ================= AUTH TREND ================= -->
  <row>
    <panel>
      <title>ğŸ“ˆ Authentication Activity</title>
      <chart>
        <search>
          <query>
            index=security_halycon sourcetype="halcyon:auth_event"
            | timechart span=1h count by result
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="legend.placement">right</option>
      </chart>
    </panel>
  </row>

</form>
