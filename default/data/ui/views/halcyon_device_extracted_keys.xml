<!--
default/data/ui/views/halcyon_device_extracted_keys.xml
Halcyon.ai for Splunk App ‚Äî Device Extracted Keys
-->

<form version="1.1" theme="light">
  <label>üîë Device Extracted Keys</label>
  <description>Cryptographic keys extracted from devices</description>

  <!-- ================= Filters ================= -->
  <fieldset submitButton="false">
    <input type="text" token="tok_device">
      <label>üñ•Ô∏è Device</label>
    </input>

    <input type="dropdown" token="tok_key_type">
      <label>üîê Key Type</label>
      <choice value="*">All</choice>
      <search>
        <query>
          index=security_halcyon sourcetype="halcyon:device_extracted_key"
          | stats count by keyType
          | sort keyType
          | fields keyType
        </query>
      </search>
      <fieldForLabel>keyType</fieldForLabel>
      <fieldForValue>keyType</fieldForValue>
      <default>*</default>
    </input>
  </fieldset>

  <!-- ================= KPI ROW ================= -->
  <row>
    <panel>
      <title>üîë Total Keys</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:device_extracted_key"
            | stats count
          </query>
        </search>
        <option name="underLabel">Keys</option>
      </single>
    </panel>

    <panel>
      <title>üñ•Ô∏è Devices</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:device_extracted_key"
            | stats dc(deviceId)
          </query>
        </search>
        <option name="underLabel">Devices</option>
      </single>
    </panel>
  </row>

  <!-- ================= KEY INVENTORY ================= -->
  <row>
    <panel>
      <title>üìã Extracted Keys</title>
      <table>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:device_extracted_key"
            | where ("$tok_key_type$"="*" OR keyType="$tok_key_type$")
            | search deviceName="*$tok_device$*"
            | eval extracted=strftime(extractedDate,"%Y-%m-%d %H:%M:%S")
            | table id deviceId deviceName keyType extracted
            | sort -extracted
          </query>
        </search>
        <option name="count">50</option>
        <option name="wrap">true</option>
        <option name="drilldown">row</option>
      </table>
    </panel>
  </row>

  <!-- ================= ACTIVITY TREND ================= -->
  <row>
    <panel>
      <title>üìà Key Extraction Activity</title>
      <chart>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:device_extracted_key"
            | timechart span=1d count
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="legend.placement">none</option>
      </chart>
    </panel>
  </row>

</form>
