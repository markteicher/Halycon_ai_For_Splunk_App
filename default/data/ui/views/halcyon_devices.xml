<!--
default/data/ui/views/halcyon_devices.xml

Halcyon.ai for Splunk App â€” Devices
-->

<form version="1.1" theme="light">
  <label>ğŸ“Ÿ Devices</label>
  <description>Endpoint and device inventory collected from Halcyon.ai</description>

  <!-- ================= Filters ================= -->
  <fieldset submitButton="false">
    <input type="text" token="tok_device_name">
      <label>ğŸ” Device Name</label>
    </input>

    <input type="text" token="tok_os_name">
      <label>ğŸ§  OS Name</label>
    </input>

    <input type="dropdown" token="tok_deleted">
      <label>ğŸ—‘ï¸ Deleted</label>
      <choice value="*">All</choice>
      <choice value="true">Deleted</choice>
      <choice value="false">Active</choice>
      <default>false</default>
    </input>
  </fieldset>

  <!-- ================= KPI ROW ================= -->
  <row>
    <panel>
      <single>
        <title>ğŸ“Ÿ Total Devices</title>
        <search>
          <query>
            index=security_halcyon sourcetype=halcyon:device
            | stats dc(id)
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["#2ecc71"]</option>
      </single>
    </panel>

    <panel>
      <single>
        <title>ğŸ’“ Reporting Devices</title>
        <search>
          <query>
            index=security_halcyon sourcetype=halcyon:device
            | where isnotnull(last_heartbeat_date)
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["#3498db"]</option>
      </single>
    </panel>

    <panel>
      <single>
        <title>âš ï¸ Inactive Devices</title>
        <search>
          <query>
            index=security_halcyon sourcetype=halcyon:device
            | where isnull(last_heartbeat_date)
            | stats count
          </query>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["#f39c12"]</option>
      </single>
    </panel>
  </row>

  <!-- ================= DEVICE INVENTORY ================= -->
  <row>
    <panel>
      <title>ğŸ–¥ï¸ Device Inventory</title>
      <table>
        <search>
          <query>
            index=security_halcyon sourcetype=halcyon:device
            | eval deleted=if(isnotnull(deleted_at),"true","false")
            | where ("$tok_deleted$"="*" OR deleted="$tok_deleted$")
            | search name="*$tok_device_name$*"
            | search os.name="*$tok_os_name$*"
            | eval created_date=strftime(created_date,"%Y-%m-%d %H:%M:%S")
            | eval last_updated_date=strftime(last_updated_date,"%Y-%m-%d %H:%M:%S")
            | eval last_heartbeat_date=strftime(last_heartbeat_date,"%Y-%m-%d %H:%M:%S")
            | table
                id
                tenant_id
                name
                os.name
                os.version
                os.os_type
                agent.name
                agent.version
                system.manufacturer
                system.model
                last_heartbeat_date
                created_date
                deleted
            | sort name
          </query>
        </search>
        <option name="count">50</option>
        <option name="wrap">true</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- ================= DEVICE ACTIVITY ================= -->
  <row>
    <panel>
      <title>ğŸ“ˆ Device Heartbeat Trend</title>
      <chart>
        <search>
          <query>
            index=security_halcyon sourcetype=halcyon:device
            | where isnotnull(last_heartbeat_date)
            | timechart span=1d count
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="legend.placement">none</option>
      </chart>
    </panel>
  </row>

</form>
