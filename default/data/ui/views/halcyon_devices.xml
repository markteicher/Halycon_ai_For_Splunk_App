<!--
default/data/ui/views/halcyon_devices.xml
Halcyon.ai for Splunk App â€” Devices
-->

<form version="1.1" theme="light">
  <label>ğŸ“Ÿ Devices</label>
  <description>Endpoint and device inventory collected from Halcyon.ai</description>

  <!-- ================= Filters ================= -->
  <fieldset submitButton="false">
    <input type="text" token="tok_device_name">
      <label>ğŸ” Device Name</label>
    </input>

    <input type="dropdown" token="tok_tenant">
      <label>ğŸ¢ Tenant</label>
      <choice value="*">All</choice>
      <search>
        <query>
          index=security_halcyon sourcetype="halcyon:device"
          | stats count by tenantId
          | sort tenantId
          | fields tenantId
        </query>
      </search>
      <fieldForLabel>tenantId</fieldForLabel>
      <fieldForValue>tenantId</fieldForValue>
      <default>*</default>
    </input>
  </fieldset>

  <!-- ================= KPI ROW ================= -->
  <row>
    <panel>
      <title>ğŸ“Ÿ Total Devices</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:device"
            | stats dc(id) as total
          </query>
        </search>
        <option name="underLabel">Devices</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ’“ Active Devices</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:device"
            lastHeartbeatDate=*
            | stats dc(id)
          </query>
        </search>
        <option name="underLabel">Active</option>
      </single>
    </panel>

    <panel>
      <title>âš ï¸ Inactive Devices</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:device"
            NOT lastHeartbeatDate=*
            | stats dc(id)
          </query>
        </search>
        <option name="underLabel">Inactive</option>
      </single>
    </panel>
  </row>

  <!-- ================= DEVICE INVENTORY ================= -->
  <row>
    <panel>
      <title>ğŸ–¥ï¸ Device Inventory</title>
      <table>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:device"
            | where ("$tok_tenant$"="*" OR tenantId="$tok_tenant$")
            | search name="*$tok_device_name$*"
            | eval created=strftime(createdDate,"%Y-%m-%d %H:%M:%S")
            | eval lastHeartbeat=strftime(lastHeartbeatDate,"%Y-%m-%d %H:%M:%S")
            | table id name tenantId deploymentGroup.name policyGroup.name lastHeartbeat created
            | sort name
          </query>
        </search>
        <option name="count">50</option>
        <option name="wrap">true</option>
        <option name="drilldown">row</option>
      </table>
    </panel>
  </row>

  <!-- ================= HEARTBEAT TREND ================= -->
  <row>
    <panel>
      <title>ğŸ“ˆ Device Heartbeat Trend</title>
      <chart>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:device"
            lastHeartbeatDate=*
            | timechart span=1d dc(id) as active_devices
          </query>
        </search>
        <option name="charting.chart">line</option>
        <option name="legend.placement">none</option>
      </chart>
    </panel>
  </row>

</form>
