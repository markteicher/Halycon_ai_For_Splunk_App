<!--
default/data/ui/views/halcyon_jobs.xml
Halcyon.ai for Splunk App ‚Äî Jobs
-->

<form version="1.1" theme="light">
  <label>üß∞ Jobs</label>
  <description>Halcyon.ai job execution status and lifecycle tracking</description>

  <!-- ================= Filters ================= -->
  <fieldset submitButton="false" autoRun="true">
    <input type="dropdown" token="tok_status">
      <label>Status</label>
      <choice value="*">All</choice>
      <choice value="Pending">Pending</choice>
      <choice value="Completed">Completed</choice>
      <choice value="Failed">Failed</choice>
      <choice value="Deleted">Deleted</choice>
      <default>*</default>
    </input>
  </fieldset>

  <!-- ================= KPI Row ================= -->
  <row>
    <panel>
      <title>üß∞ Total Jobs</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:job"
            | stats count
          </query>
        </search>
        <option name="underLabel">Jobs</option>
      </single>
    </panel>

    <panel>
      <title>‚è≥ Pending</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:job" status="Pending"
            | stats count
          </query>
        </search>
        <option name="underLabel">Pending</option>
      </single>
    </panel>

    <panel>
      <title>‚ùå Failed</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:job" status="Failed"
            | stats count
          </query>
        </search>
        <option name="underLabel">Failed</option>
      </single>
    </panel>

    <panel>
      <title>‚úÖ Completed</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:job" status="Completed"
            | stats count
          </query>
        </search>
        <option name="underLabel">Completed</option>
      </single>
    </panel>
  </row>

  <!-- ================= Job Inventory ================= -->
  <row>
    <panel>
      <title>üìã Job Inventory</title>
      <table>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:job"
            | where ("$tok_status$"="*" OR status="$tok_status$")
            | eval createdAt=strptime(createdAt,"%Y-%m-%dT%H:%M:%S")
            | eval completedAt=strptime(completedAt,"%Y-%m-%dT%H:%M:%S")
            | eval createdAt=strftime(createdAt,"%Y-%m-%d %H:%M:%S")
            | eval completedAt=strftime(completedAt,"%Y-%m-%d %H:%M:%S")
            | table id status createdAt completedAt
            | sort -createdAt
          </query>
        </search>
        <option name="count">50</option>
        <option name="wrap">true</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- ================= Job Activity Trend ================= -->
  <row>
    <panel>
      <title>üìà Job Activity Over Time</title>
      <chart>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:job"
            | eval _time=strptime(createdAt,"%Y-%m-%dT%H:%M:%S")
            | timechart span=1d count by status
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="legend.placement">right</option>
      </chart>
    </panel>
  </row>

</form>
