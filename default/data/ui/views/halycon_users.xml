<form version="1.1" theme="light">
  <label>ğŸ‘¥ Halcyon Users</label>
  <description>Halcyon platform users</description>

  <fieldset submitButton="false" autoRun="true">
    <row>
      <panel>
        <title>ğŸ” Filters</title>

        <input type="text" token="tok_user_search">
          <label>Search</label>
        </input>

        <input type="dropdown" token="tok_role">
          <label>Role</label>
          <choice value="*">All</choice>
          <choice value="Admin">Admin</choice>
          <choice value="TenantAdmin">TenantAdmin</choice>
          <choice value="PowerUser">PowerUser</choice>
          <choice value="User">User</choice>
          <choice value="ReadOnly">ReadOnly</choice>
          <default>*</default>
        </input>
      </panel>
    </row>
  </fieldset>

  <row>
    <panel>
      <title>ğŸ‘¥ Total Users</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:user"
            | stats count
          </query>
        </search>
        <option name="underLabel">Users</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ›¡ï¸ Admin</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:user" role="Admin"
            | stats count
          </query>
        </search>
        <option name="underLabel">Admin</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ¢ Tenant Admin</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:user" role="TenantAdmin"
            | stats count
          </query>
        </search>
        <option name="underLabel">TenantAdmin</option>
      </single>
    </panel>

    <panel>
      <title>ğŸ‘€ Read Only</title>
      <single>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:user" role="ReadOnly"
            | stats count
          </query>
        </search>
        <option name="underLabel">ReadOnly</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>ğŸ“Š Users by Role</title>
      <chart>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:user"
            | stats count by role
            | sort - count
          </query>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>ğŸ§¾ Users</title>
      <table>
        <search>
          <query>
            index=security_halcyon sourcetype="halcyon:user"
            | eval blob=lower(coalesce(id,"")." ".coalesce(email,"")." ".coalesce(firstName,"")." ".coalesce(lastName,""))
            | where ("$tok_role$"="*" OR role="$tok_role$")
            | where ("$tok_user_search$"="" OR like(blob,"%".lower("$tok_user_search$")."%"))
            | table id email firstName lastName role
            | sort firstName lastName
          </query>
        </search>
        <option name="count">50</option>
        <option name="wrap">true</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
</form>
