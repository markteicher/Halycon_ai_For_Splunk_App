<form version="1.1" theme="light">
  <label>ğŸ·ï¸ Tags</label>
  <description>Tag definitions used across assets, policies, and deployments</description>

  <!-- ================= Filters ================= -->
  <fieldset submitButton="false">
    <input type="text" token="tok_tag_search">
      <label>ğŸ” Tag Name</label>
    </input>
  </fieldset>

  <!-- ================= KPI ROW ================= -->
  <row>
    <panel>
      <single>
        <title>ğŸ·ï¸ Total Tags</title>
        <search>
          <query>
            index=security_halycon sourcetype="halcyon:tag"
            | stats count
          </query>
        </search>
        <option name="underLabel">Tags</option>
      </single>
    </panel>

    <panel>
      <single>
        <title>ğŸ•’ Recently Updated</title>
        <search>
          <query>
            index=security_halycon sourcetype="halcyon:tag"
            | where _time &gt; relative_time(now(), "-7d")
            | stats count
          </query>
        </search>
        <option name="underLabel">Last 7 Days</option>
      </single>
    </panel>
  </row>

  <!-- ================= TAG INVENTORY ================= -->
  <row>
    <panel>
      <title>ğŸ“‹ Tag Inventory</title>
      <table>
        <search>
          <query>
            index=security_halycon sourcetype="halcyon:tag"
            | eval blob=lower(coalesce(id,"")." ".coalesce(name,""))
            | where ("$tok_tag_search$"="" OR like(blob,"%".lower("$tok_tag_search$")."%"))
            | eval created=strftime(createdDate,"%Y-%m-%d %H:%M:%S")
            | eval updated=strftime(lastUpdatedDate,"%Y-%m-%d %H:%M:%S")
            | table id name created updated
            | sort name
          </query>
        </search>
        <option name="count">50</option>
        <option name="wrap">true</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <!-- ================= TAG ACTIVITY ================= -->
  <row>
    <panel>
      <title>ğŸ“ˆ Tag Creation Trend</title>
      <chart>
        <search>
          <query>
            index=security_halycon sourcetype="halcyon:tag"
            | timechart span=1d count
          </query>
        </search>
        <option name="charting.chart">column</option>
        <option name="legend.placement">none</option>
      </chart>
    </panel>
  </row>

</form>
